# Bug Collector Package

[![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](https://opensource.org/licenses/Apache-2.0)

## What is it?

The bug collector package from frameVPM contains a tool that leverage the information contains in the dataset generated by the Data7 tool to create a bug fix dataset. 
Indeed to find the highest number of vulnerabilities in a project, data7 try to link reference of bug id as mentionned in vulnerability report and in commit message. Thus all commits mentionning a bug id are stored in case a vulnerability report declare this bug id as the one related to the vulnerability later on. This information can be use to create a bug fix dataset by retrieving the information on all those commits in a similar manner as the one use to create the Data7 dataset.

Similarly to the Data7 tool, the bug collector tool create a dataset that can easily be updated with the latest version of the vulnerability dataset. The information that can be found in the dataset is the following:

list of commits that fixed a bug which contains:

- hash
- timestamp
- message
- fixes (files in their states before and after fix)
    
## Why? 

Vulnerabilities have often been considered as a subset of bugs. Yet, finding vulnerabilities is trickier than just simply uncovering a bug, which make a dataset of vulnerabilities more difficult to create than a bug one. Still, the creation of a bug fix dataset that complement the vulnerability one offer many benefits.
 
 
 First, in the case of the present framework it allows to perform studies on how well VPM differentiate between bugs and vulnerabilities. Second, similarity analysis can be made to find potential bug fix that actually correspond to a vulnerability fix. Lastly,


## Requirements

To create and update a bug dataset, only a configured installation of the data7 tool is required.
Maven will handle the dependancy.

## How does it work ?
For a given project P

* Creating a dataset
   


* Updating a dataset
    


## Dataset Structure
            

## Supported projects

Currently four open source projects are supported :

* Linux Kernel
* Wireshark
* OpenSSL
* SystemD

but it can easily be extended to any other project where it is possible to find the following information:

*  name of the project as it appears in NVD database, e.g, linux_kernel
*  url of a git remote repository, e.g, https://github.com/torvalds/linux
*  regular expression catching link to remote repository and hashes in it, e.g, .*?(github\\.com|git\\.kernel\\.org).*?(commit)+.*?(h\\=|/)+([a-f0-9]+)
*  url of a bug tracker, e.g, https://bugzilla.kernel.org/
*  regular expression catching link to bug tracker and bug id in it, e.g, .*(bugzilla\\.kernel\\.org).*?(id\\=)([0-9]+)
*  regular expression catching bug id in git commit message, e.g, .*(bugzilla\\.kernel\\.org).*?(id\\=)([0-9]+)

## How to use the tools

1. To use the tool, the first step is to create a folder in your local storage that will gather all data.
    The structure once run the tool should look like this
    - myfolder
        - git
        - cve
        - xml
        - binary
    
2. Then head to data7/src/main/java/data7/Ressources.java and change the PATH_TO_SAVE value by your folder path.
3. Once done, you can run mvn install and the tool is installed
4. To call it from your code, just call 
```java
 import data7.project.CProjects;
 import data7.project.Project;   
 
Importer.updateOrCreateDatasetFor(aProject);
// Projects are available in projects module
//like CProjects.LINUX_KERNEL
``` 
    
Note that on creation of the dataset it might be better for the largest project (Linux, Wireshark)to first clone the git repository using command line in your folder under the subfolder git (in the case of Linux, don't forget to rename Linux into linux_kernel)

## Statistics

As of 5th June 2018

| Projects   | Time to create | Dataset size |Number of vulnerabilities | NoV with Fixes | average CVSS | avg CVSS with fixes | Number of Fix | Number of FileFix| Number of Unique Vulnerable Files |
|:----------:|:--------------:|:------------:|:------------------------:|:--------------:|:------------:|:-------------------:|:-------------:|:----------------:|:---------------------------------:|
|Linux Kernel|115 mn          |279.7 MB      |2082                      |1202            |5.41          |5.34                 |1332           | 2612             |1508                               |
|Wireshark   |129 mn          |561.9 MB      | 531                      | 265            |4.99          |5.01                 | 850           |  987             | 221                               |
|OpenSSL     |  8 mn          |173.3 MB      | 187                      | 126            |5.34          |5.42                 | 493           | 1018             | 164                               |
|SystemD     |  2 mn          |  2.4 MB      |   9                      |   5            |5.76          |5.60                 |   5           |    6             |   5                               |
|Total       |254 mn          |  1.0 GB      |2809                      |1598            |5.375         |5.34                 |2680           | 4623             |1898                               |



### Top 10 Buggy Files

| Rank | Linux                     | Wireshark                              | OpenSSL                    | SystemD                                |
|:----:|:--------------------------|:---------------------------------------|:---------------------------|:---------------------------------------|
| 1    | arch/x86/kvm/x86.c (17)   | epan/proto.c (24)                      | ssl/s3_clnt.c (53)         | src/resolve/resolved-dns-packet.c (2)  |
| 2    | fs/namei.c (14)           | epan/dissectors/packet-nbap.c (19)     | ssl/s3_srvr.c (41)         | src/resolve/resolved-dns-packet.h (1)  |
| 3    | net/socket.c (14)         | epan/dissectors/packet-ncp2222.inc (19)| ssl/d1_both.c (35)         | src/util.c (1)                         |
| 4    | kernel/signal.c (14)      | epan/dissectors/packet-wccp.c (18)     | ssl/t1_lib.c (34)          | src/nss-mymachines/nss-mymachines.c (1)|
| 5    | fs/namespace.c (14)       | epan/crypt/airpdcap.c (18)             | ssl/d1_pkt.c (22)          | src/tmpfiles/tmpfiles.c (1)            |
| 6    | kernel/bpf/verifier.c (13)| epan/dissectors/packet-ber.c (17)      | crypto/asn1/tasn_dec.c (20)|                                        |
| 7    | net/sctp/socket.c (13)    | epan/dissectors/packet-umts_fp.c (16)  | ssl/ssl.h (20)             |                                        |
| 8    | fs/exec.c (13)            | epan/dissectors/packet-wbxml.c (15)    | ssl/s3_pkt.c (20)          |                                        |
| 9    | arch/x86/kvm/vmx.c (13)   | epan/dissectors/packet-wsp.c (14)      | ssl/ssl_err.c (17)         |                                        |
| 10   | fs/open.c (12)            | epan/dissectors/packet-wcp.c (13)      | crypto/x509/x509_vfy.c (16)|                                        |



## About Me

This tool was developed during my thesis and is made available to everyone. :)